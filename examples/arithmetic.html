<html>
	<head>
		<title>A simple arithmetic parser</title>
		<script type="text/javascript" src="../src/p4.js"></script>
		<script type="text/javascript">
      		var p = P4JS;

			// Used combinators
			var _do       = p._do,
				_return   = p._return,
				_many1    = p._many1,
				_choice   = p._choice,
				_token    = p._token,
				_digit    = p._digit,
				_symbol   = p._symbol,
				joinArray = p.joinArray;

			// Parse integer
			var _int = _do(_token(_many1(_digit))).doReturn(joinArray("", parseInt));

			// <Factor> ::= <Num> | ( <Exp> ) | - <Factor>
			var _factor = function(s) {
				return _choice(
					_do(_symbol("("), _exp, _symbol(")")).doReturn(function(_, f, __) { return f; }),
					_do(_symbol("-"), _factor).doReturn(function(_, f) { return 0.0 - f; }),
					_int)(s);
			};

			// <Term> ::=  <Factor> * <Term> | <Factor> / <Term> | <Factor>
			var _term = _do(_factor).doResult(
				function(f) {
					return _choice(
						_do(_symbol("*"), _exp).doReturn(function(_, e) { return f * e; } ),
						_do(_symbol("/"), _exp).doReturn(function(_, e) { return f / e; } ),
						_return(f));
				});

			// <Exp> ::= <Term> + <Exp> | <Term> - <Exp> | <Term>
			var _exp = _do(_term).doResult(
				function(t) {
					return _choice(
						_do(_symbol("+"), _exp).doReturn(function(_, e) { return t + e; } ),
						_do(_symbol("-"), _exp).doReturn(function(_, e) { return t - e; } ),
						_return(t));
				});

			// Executor
			function parse(input) {
				var rdiv  = document.getElementById('rdiv'),
				    error = document.getElementById('error');

				// Reset results
				rdiv.innerHTML = "";
				error.innerHTML = "";

				// Parse and print results or error
				try {
					rdiv.innerHTML = p.parse(_exp, input);
				} catch(e) {
					error.innerHTML = p.errorToString(e);
				}
			};
		</script>
	</head>

	<body>
			<h3>A simple expression parser</h3>

		<p>
			<span>Expression:</span>
			<input type="text" id="expression" value="12 - (3 * 2)"></input>
			<a href="javascript:;" onclick="parse(document.getElementById('expression').value);">Parse</a>
		</p>

		<p>
			Result: <span id="rdiv"></span> <span id="error" style="color:red;"></span>
		</p>
	</body>
</html>
