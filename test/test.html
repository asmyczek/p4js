<html>
	<head>
		<title>P4JS - Unit tests</title>
        <style>
          span.ok { color: green; }
          span.error { color: red; font-weight: bolder; }
        </style>
		<script type="text/javascript" src="../src/p4.js"></script>
		<script type="text/javascript">
          // Unit test helpers
          var p = P4JS;

          // Ok output
          var ok = function(desc) {
            document.writeln(desc + " - <span class='ok'>OK</span></br>");
          };

          // Error output
          var error = function(desc, msg) {
            document.writeln(desc + " - <span class='error'>" + msg + "</span><br/>");
          };

          // Assert function
          var assert = function(parser, input, result, desc) {
            try {
              var value = p.parse(parser, input);
              if (result === value) {
                  ok(desc);
              } else {
                  error(desc, "Error: expecting '" + result + "' but result is '" + value + "' !");
              }
            } catch(e) {
              error(desc, "Exception: " + e.message);
            }
          };

          // Assert exception is thrown
          var assertException = function(parser, input, desc) {
            try {
              var value = p.parse(parser, input);
              error(desc, "Exception expected, but not thrown!");
            } catch(e) {
              ok(desc);
            }
          };

		</script>
	</head>
	<body>
		<h3>P4JS - Unit tests</h3>

		<p>
        <div><b>Basic combinators</b></div>
		<script type="text/javascript">
		assert(p._return("abc"), "", "abc", "_return");
		assertException(p._failure("Exception"), "abc", "_failure");

		assert(p._item, "a", "a", "_item");
		assert(p._digit, "1", "1", "_digit");
		assert(p._alpha, "a", "a", "_alpha");
		assert(p._alphanum, "a", "a", "_alphanum(alpha)");
		assert(p._alphanum, "1", "1", "_alphanum(num)");
		assert(p._lower, "a", "a", "_lower");
		assert(p._upper, "A", "A", "_upper");

		assert(p._char("a"), "a", "a", "_char");
		assert(p._string("ab1"), "ab1", "ab1", "_string");
		assert(p._choice(p._char('a'), p._char('b')), "a", "a", "_choice(1)");
		assert(p._choice(p._char('a'), p._char('b')), "b", "b", "_choice(2)");

        assert(p._do(p._many(p._digit)).doReturn(p.joinArray()), "123", "123", "_many");
        assert(p._do(p._many(p._digit)).doReturn(p.joinArray()), "", "", "_many(empty)");
        assert(p._do(p._many1(p._digit)).doReturn(p.joinArray()), "123", "123", "_many1");
        assertException(p._do(p._many1(p._digit)).doReturn(p.joinArray()), "", "_many1(empty)");

		assert(p._do(p._manyTill(p._item, p._char(",")), p._char(",")).doReturn(p.joinArray()), "abc,", "abc", "_manyTill");
		assert(p._oneOf("abc"), "a", "a", "_oneOf");
		assertException(p._oneOf("abc"), "1abc,", "_oneOf(negative)");
		assert(p._noneOf("abc"), "1", "1", "_noneOf");
		assertException(p._noneOf("abc"), "abc,", "_noneOf(negative)");

		</script>
		</p>

		<p>
		<div><b>Tokenizer</b></div>
		<script type="text/javascript">
		assert(p._space, "  ", "", "_space");
		assert(p._token(p._string("ab1")), "  ab1   ", "ab1", "_token");
		assert(p._seq, "  ab1   ", "ab1", "_seq");
		assert(p._symbol("ab1"), "  ab1   ", "ab1", "_symbol");
		assert(p._eol, "\n", "\n", "_eol");
		</script>
		</p>

	</body>
</html>
