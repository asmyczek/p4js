<html>
	<head>
		<title>P4JS - Unit tests</title>
        <style>
          span.ok { color: green; }
          span.error { color: red; font-weight: bolder; }
        </style>
		<script type="text/javascript" src="../src/p4.js"></script>
		<script type="text/javascript">
          // Unit test helpers
          var p = P4JS;

          // Ok output
          var ok = function(desc) {
            document.writeln(desc + " - <span class='ok'>OK</span></br>");
          };

          // Error output
          var error = function(desc, msg) {
            document.writeln(desc + " - <span class='error'>" + msg + "</span><br/>");
          };

          // Assert function
          var assert = function(parser, input, result, desc) {
            try {
              var value = p.parse(parser, input);
              if (result === value) {
                  ok(desc);
              } else {
                  error(desc, "Error: expecting '" + result + "' but result is '" + value + "' !");
              }
            } catch(e) {
              error(desc, "Exception: " + e.message);
            }
          };

          // Assert exception is thrown
          var assertException = function(parser, input, desc) {
            try {
              var value = p.parse(parser, input);
              error(desc, "Exception expected, but not thrown!");
            } catch(e) {
              ok(desc);
            }

          };

		</script>
	</head>
	<body>
		<h3>P4JS - Unit tests</h3>

        <div><b>Basic combinators</b></div>
		<script type="text/javascript">
		assert(p._return("abc"), "abc", "abc", "_return");
		assertException(p._failure("Exception"), "abc", "_failure");

		assert(p._item, "abc", "a", "_item");
		assert(p._digit, "123", "1", "_digit");
		assert(p._alpha, "abc", "a", "_alpha");
		assert(p._alphanum, "abc", "a", "_alphanum(alpha)");
		assert(p._alphanum, "123", "1", "_alphanum(num)");
		assert(p._lower, "abc", "a", "_lower");
		assert(p._upper, "ABC", "A", "_upper");

		assert(p._char("a"), "abc", "a", "_char");
		assert(p._string("ab1"), "ab1", "ab1", "_string");
		assert(p._choice(p._char('a'), p._char('b')), "abc", "a", "_choice(1)");
		assert(p._choice(p._char('a'), p._char('b')), "bc", "b", "_choice(2)");

        assert(p._do(p._many(p._digit)).doReturn(function(r) { return r.join(""); }), "123", "123", "_many");
        assert(p._do(p._many(p._digit)).doReturn(function(r) { return r.join(""); }), "", "", "_many(empty)");
        assert(p._do(p._many1(p._digit)).doReturn(function(r) { return r.join(""); }), "123", "123", "_many1");
        assertException(p._do(p._many1(p._digit)).doReturn(function(r) { return r.join(""); }), "", "_many1(empty)");

/*

  p._space      = _space;
  p._token      = _token;
  p._seq        = _seq;
  p._symbol     = _symbol;
  p._eol        = _eol;

  p._manyTill   = _manyTill;
  p._oneOf      = _oneOf;
  p._noneOf     = _noneOf;
  
  p._csv        = _csv;
*/
		</script>

	</body>
</html>
